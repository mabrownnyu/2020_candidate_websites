/* ========================================================================= */
/* BE SURE TO COMMENT CODE/IDENTIFY PER PLUGIN CALL */
/* ========================================================================= */

jQuery(function($){

    // ORPHANIZER
    function orphanize(){
        $(".orphan").each(function() {
            let txt = $(this).html().trim().replace('&nbsp;',' ');
            let wordArray = txt.split(" ");
            if (wordArray.length > 1) {
                wordArray[wordArray.length-2] += "&nbsp;" + wordArray[wordArray.length-1];
                wordArray.pop();
                $(this).html(wordArray.join(" "));
            }
        });
    };
    orphanize();

    // PARALLAX
    $.fn.plax = function(x, y){
        this.css({
            'webkitTransform' : 'translate3d('+x+'px, '+y+'px, 0)',
            'MozTransform'    : 'translate3d('+x+'px, '+y+'px, 0)',
            'msTransform'     : 'translateX('+x+'px) translateY('+y+'px)',
            'OTransform'      : 'translate3d('+x+'px, '+y+'px, 0)',
            'transform'       : 'translate3d('+x+'px, '+y+'px, 0)'
        });
    };

    $(document).scroll(function(){
        var nm = $("html").scrollTop();
        var nw = $("body").scrollTop();
        var n = (nm > nw ? nm : nw);

        //$('.slide').plax(0,n);

        // if transform3d isn't available, use top over background-position
        $('.slide').css('top', Math.ceil(n/2) + 'px');


        if(n > 500){
            $('#logo').addClass('shrink');
        } else {
            $('#logo').removeClass('shrink');
        }

    });


    $('#event-slider').slick({
        autoplay: false,
        slidesToShow: 4,
        slidesToScroll: 4,
        swipeToSlide: true,
        infinite: true,
        fade: false,
        speed: 500,
        swipe: true,
        draggable: true,
        dots: false,
        arrows: true,
        prevArrow: '<span class="slider-arrow arrow-prev"></span>',
        nextArrow: '<span class="slider-arrow arrow-next"></span>',
        responsive: [
            { breakpoint: 900,
              settings: {
                slidesToShow: 3,
                slidesToScroll: 3,
                infinite: true
              }
            },
            { breakpoint: 700,
              settings: {
                slidesToShow: 2,
                slidesToScroll: 2,
                infinite: true
              }
            },
            { breakpoint: 500,
              settings: {
                slidesToShow: 1,
                slidesToScroll: 1,
                infinite: true
              }
            }
        ]
    });

    $('.slideshow').slick({
        autoplay: false,
        slidesToShow: 1,
        slidesToScroll: 1,
        swipeToSlide: true,
        infinite: true,
        fade: true,
        speed: 500,
        swipe: true,
        draggable: true,
        dots: false,
        arrows: true,
        prevArrow: '<span class="slider-arrow arrow-prev"></span>',
        nextArrow: '<span class="slider-arrow arrow-next"></span>'
    });


    $('.issue h3 button').on('click', function(){
        $(this).parent().next().slideToggle('500');
        $(this).parent().next().attr('aria-expanded', function (i, attr) {
            return attr == 'true' ? 'false' : 'true';
        });
        $(this).parent().toggleClass('open');
    });



    $('.magnific').magnificPopup({
        type: 'inline',
        closeMarkup: '<button title="%title%" type="button" class="mfp-close"><svg viewbox="0 0 20 14" xmlns="http://www.w3.org/2000/svg"><path d="M10 5.56L4.722.28c-.384-.383-1.02-.372-1.417.025-.397.398-.408 1.033-.024 1.417L8.559 7l-5.278 5.278c-.384.384-.373 1.02.024 1.417.398.397 1.033.408 1.417.024L10 8.441l5.278 5.278c.384.384 1.02.373 1.417-.024.397-.398.408-1.033.024-1.417L11.441 7l5.278-5.278c.384-.384.373-1.02-.024-1.417-.398-.397-1.033-.408-1.417-.024L10 5.559z"/></svg>Close</button>',
        fixedContentPos: true
    });

    $('.play').magnificPopup({
        type: 'iframe',
        closeMarkup: '<button title="%title%" type="button" class="mfp-close"><svg viewbox="0 0 20 14" xmlns="http://www.w3.org/2000/svg"><path d="M10 5.56L4.722.28c-.384-.383-1.02-.372-1.417.025-.397.398-.408 1.033-.024 1.417L8.559 7l-5.278 5.278c-.384.384-.373 1.02.024 1.417.398.397 1.033.408 1.417.024L10 8.441l5.278 5.278c.384.384 1.02.373 1.417-.024.397-.398.408-1.033.024-1.417L11.441 7l5.278-5.278c.384-.384.373-1.02-.024-1.417-.398-.397-1.033-.408-1.417-.024L10 5.559z"/></svg>Close</button>',
        iframe: {
            markup: '<div class="mfp-iframe-scaler">'+
                '<div class="mfp-close"></div>'+
                '<iframe class="mfp-iframe" frameborder="0" allowfullscreen></iframe>'+
                '<h4 class="mfp-title"></h4>'+
                '</div>',
            patterns: {
                youtube: {
                  src: '//www.youtube.com/embed/%id%?autoplay=1&rel=0&controls=0showinfo=0' // URL that will be set as a source for iframe.
                },
                vimeo: {
                  src: '//player.vimeo.com/video/%id%?autoplay=1'
              }
            }

        },
        callbacks: {
            markupParse: function(template, values, item) {
                values.title = item.el.attr('title');
            }
        },
        removalDelay: 300,
        mainClass: 'mfp-fade'
    });

    $('.magnific-ajax').magnificPopup({
        type: 'ajax',
        closeMarkup: '<button title="%title%" type="button" class="mfp-close"><svg viewbox="0 0 20 14" xmlns="http://www.w3.org/2000/svg"><path d="M10 5.56L4.722.28c-.384-.383-1.02-.372-1.417.025-.397.398-.408 1.033-.024 1.417L8.559 7l-5.278 5.278c-.384.384-.373 1.02.024 1.417.398.397 1.033.408 1.417.024L10 8.441l5.278 5.278c.384.384 1.02.373 1.417-.024.397-.398.408-1.033.024-1.417L11.441 7l5.278-5.278c.384-.384.373-1.02-.024-1.417-.398-.397-1.033-.408-1.417-.024L10 5.559z"/></svg>Close</button>',
        fixedContentPos: true,
        mainClass: 'ajax',
        callbacks: {
            parseAjax: function(mfpResponse) {
            }
        }

    });



    $(document).ready(function () {
        if (Cookies.get('joinus')) {
            //$('#cookies').hide();
        } else {
            $.magnificPopup.open({
                closeMarkup: '<button title="%title%" type="button" class="mfp-close"><svg viewbox="0 0 20 14" xmlns="http://www.w3.org/2000/svg"><path d="M10 5.56L4.722.28c-.384-.383-1.02-.372-1.417.025-.397.398-.408 1.033-.024 1.417L8.559 7l-5.278 5.278c-.384.384-.373 1.02.024 1.417.398.397 1.033.408 1.417.024L10 8.441l5.278 5.278c.384.384 1.02.373 1.417-.024.397-.398.408-1.033.024-1.417L11.441 7l5.278-5.278c.384-.384.373-1.02-.024-1.417-.398-.397-1.033-.408-1.417-.024L10 5.559z"/></svg>Close</button>',
                items: {
                    src: '#joinus'
                },
                type: 'inline',
                callbacks: {
                    close: function() {
                        Cookies.set('joinus', 'dismiss', { expires: 1, path: '/' });
                    }
                }
            });

        };
    });

    $('#alert .close').on('click' , function(){
        $(this).closest('#alert').addClass('close');
    })

    $('#nav-toggle').click(function(){
        $('#mobile-nav-container').slideToggle(200).toggleClass('open');
        $(this).children('span').toggleClass('open');
    });


    $('a.smooth, .smooth a').click(function(){
        $('html, body').animate({
            scrollTop: $( $(this).attr('href') ).offset().top
        }, 500);
        return false;
    });

    $('#mobile-nav-container a.smooth, #mobile-nav-container .smooth a').click(function(){
        $('html, body').animate({
            scrollTop: $( $(this).attr('href') ).offset().top
        }, 500);
        $('#mobile-nav-container').slideToggle(200).toggleClass('open');
        $('#nav-toggle span').toggleClass('open');

        //return false;
    });

    $('a[href="' + $(location).attr('hash') + '"]').trigger('click');

    /* ====== Twitter API Call =============================================
        This script automatically adds <li> before and after template. Don't forget to setup Auth info in /twitter/index.php */
    /*
    $('#tweets-loading').tweet({
        modpath: '/path/to/twitter/', // only needed if twitter folder is not in root
        username: 'jackrabbits',
        count: 1,
	template: '<p>{text}</p><p class="tweetlink">{time}</p>'
    });
    $('.tweet_text a').each(function(){
        $(this).attr('target','_blank');
    });
    */

});
