function attachFormListeners(form) {
  form.onsubmit = event => {
    event.preventDefault();

    var emailInput = form.querySelector('[name=\'email\']');
    var zipInput = form.querySelector('[name=\'zip\']');
    var userEmail = emailInput.value;
    var userZip = zipInput.value;

    if (! userEmail) {
      console.error('Email required!');
      return;
    }

    if (! userZip) {
      console.error('Zip code required!');
      return;
    }

    const SIGNUP_URL = '/wp-json/yang-api/v1/sign-up';
    const DONATE_URL = 'https://secure.actblue.com/donate/friends-of-andrew-yang';
    // const DONATE_URL = 'https://secure.actblue.com/donate/yang-cnn-townhall-web';
    fetch(SIGNUP_URL, {
      method: 'POST',
      body: JSON.stringify({email: userEmail, zip: userZip}),
      headers:{
        'Content-Type': 'application/json'
      },
    })
      .then(response => {
        window.location.href = DONATE_URL;
        return response.json();
      })
      .catch(error => {
        console.error('error', error);
        window.location.href = DONATE_URL;
      });
  };
}

function setupFormListeners() {
  var joinForms = Array.from(document.querySelectorAll('.join-form'));
  joinForms.forEach(attachFormListeners);
};

var underlinePolicyTitle = function () {
  // Don't show for new policies
  var titleElement = document.querySelector('.single-policy:not(.new-policy) .entry-title');
  if (titleElement) {
    var title = titleElement.innerHTML;
    titleElement.innerHTML = `<span class='underline-gray-light'>${title}</span>`;
  }
};

DomReady.ready(function () {
  setupFormListeners();
  underlinePolicyTitle();

  if (navigator && navigator.platform) {
    if (navigator.platform.toLowerCase().includes('mac')) {
      document.body.classList.add('mac-computer');
    }
    else {
      document.body.classList.add('pc-computer');
    }
  }
});
